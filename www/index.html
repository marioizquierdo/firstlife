<!DOCTYPE html>
<html>
  <head>
    <title>Real-life Games Engine</title>

  	<meta name="apple-mobile-web-app-capable" content="yes" />
  	<meta names="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no;" />
  	<meta charset="utf-8">

  	<link rel="stylesheet" href="index.css" />

  	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.css" />
  	<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
  	<script src="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.js"></script>

    <script type="text/javascript" charset="utf-8" src="http://static.firebase.com/v0/firebase.js"></script>

    <script type="text/javascript" charset="utf-8" src="knockout.js"></script>
    <script type="text/javascript" charset="utf-8" src="underscore.js"></script>
    <script type="text/javascript" charset="utf-8" src="cordova-1.8.1.js"></script>


    <script type="text/javascript" charset="utf-8" src="user.js"></script>
    <script type="text/javascript" charset="utf-8" src="model.js"></script>

  </head>
  <body>

    <!-- Initialization STUFF -->

    <div id="fb-root"></div>

    <script>
      (function() {
        var e = document.createElement('script'); e.async = true;
            e.src = document.location.protocol + '//connect.facebook.net/en_US/all.js';
            document.getElementById('fb-root').appendChild(e);
            }());
    </script>

    <script>
      window.fbAsyncInit = function() {
        FB.init({ appId: '450301521661226',
                  status: true,
                  cookie: true,
                  xfbml: true,
                  oauth: true});

        FB.Event.subscribe('auth.statusChange', handleStatusChange);
      };

      function handleStatusChange(response) {
        document.body.className = response.authResponse ? 'connected' : 'not_connected';

        if (response.authResponse) {
          onUserLoggedIn(response);
        }
      }

      function onUserLoggedIn(response) {
        //$('#login').remove();
        FB.api('/me', onUserFetch);
      }

      function onUserFetch(fbUserProfile) {
        FLModel.createUser(fbUserProfile.id, fbUserProfile, function(userId) {
          FLModel.bindUserChange(userId, function(user) { FLApp.localUser(user); });
          FLModel.bindUsersChange(function(users) {
            FLApp.allUsers(users);
            $('#leaderboard ul[data-role="listview"]:visible').listview('refresh');
            $('#ass-list ul[data-role="listview"]:visible').listview('refresh');
            $('#nice-list ul[data-role="listview"]:visible').listview('refresh');
          });
          FLModel.bindUserKickedByChange(userId, function(kickedBy) {
            FLApp.lastKickedBy = kickedBy;
            $.mobile.changePage('#nice-list');
            // alert("you got kicked! guess who!");
          });
	        // Initial correct page
	        if (FLApp.localUser().role == 'asshole') {
	          $.mobile.changePage('#ass-main');
	        }
	        else {
	          $.mobile.changePage('#nice-main');
	        }
        });
      }

      function loginUser() {
        FB.login(function(response) { }, {scope:'email'});
      }
    </script>


    <!-- START PAGE -->
    <div id="page" data-role="page">
      <div data-role="header"><h1>Asshole</h1></div>
      <div data-role="content">
        <p>Some players are going to be assholes and they will earn respect by kicking others. The other players have to guess who was the asshole.</p>
        <div id="login">
          <button data-role="button" onClick="loginUser();">Login with Facebook</button>
        </div>
      </div>
    </div>


    <!-- ASSHOLE MAIN -->
    <div id="ass-main" data-role="page">
      <div data-role="header">
        <h1>Asshole</h1>
        <a href="#leaderboard" data-icon="star" data-theme="b" class="ui-btn-right" data-transition="flip">Leaderboard</a>
      </div>
      <div data-role="content">
        <img style="float: left; margin: 15px 15px 15px 0;" class="ui-corner-all" data-bind="if: localUser, attr: { src: localUser().fbProfileUrlBig }"/>
        <h3><span data-bind="if: localUser, text: localUser().first_name"></span> &nbsp; <span class="role-label asshole">Asshole</span></h3>
        <p>Respect: <span data-bind="if: localUser, text: localUser().score"></span></p>
        <p>You are one of the assholes, and because you are a dick you should kick someone's ass</p>
        <div style="clear:both"></div>

        <ul data-role="listview" data-inset="true">
          <li>
            <a href="#ass-list" data-transition="slide">Kick someone!</a>
          </li>
        </ul>
      </div>
    </div>

    <!-- NICE GUY MAIN -->
    <div id="nice-main" data-role="page">
      <div data-role="header">
        <h1>Nice Guy</h1>
        <a href="#leaderboard" data-icon="star" data-theme="b" class="ui-btn-right" data-transition="flip">Leaderboard</a>
      </div>
      <div data-role="content">
        <img style="float: left; margin: 15px 15px 15px 0;" class="ui-corner-all" data-bind="if: localUser, attr: { src: localUser().fbProfileUrlBig }"/>
        <h3><span data-bind="if: localUser, text: localUser().first_name"></span> &nbsp; <span class="role-label nice-guy">Nice Guy</span></h3>
        <p>Respect: <span data-bind="if: localUser, text: localUser().score"></span></p>
        <p>You are a nice guy and as such you can not kick people. You can earn respect by identifying the asshole if they kick you though.</p>
      </div>
    </div>

    <!-- ASSHOLE KICK LIST -->
    <div id="ass-list" data-role="page">
      <div data-role="header">
        <a href="#" data-rel="back">Back</a>
        <h1>Kick!</h1>
      </div>
      <div data-role="content">
        <p>KICK one of these "nice guys" to gain some RESPECT</p>
        <p>Current Respect: <span data-bind="if: localUser, text: localUser().score"></span> (+10 after kick). But take care! if he blames you, your asshole days are over.</p>

        <ul data-role="listview" data-inset="true" data-bind="foreach: allUsers">
          <!-- ko if: role == 'nicehole' -->
          <li style="height: 75px;">
            <a data-bind="attr: { onClick: 'FLModel.kick(FLApp.localUser(), ' + $data.id + ');FLApp.userLastKicked = \'' + $data.first_name + ' ' + $data.last_name + '\';' }" href="dialog-asshole-wait.html" data-rel="dialog">
              <img class="ui-li-thumb ui-corner-all leaderboard-profile-img" data-bind="attr: { src: fbProfileUrl }"/>
              <h3>Kick <span data-bind="text: name"></span> (he has <span data-bind="text: score"></span> respect points)</h3>
              <h4 style="position: absolute; right: 20px; top: 10px;"></h4>
            </a>
          </li>
          <!-- /ko -->
        </ul>
      </div>
    </div>

    <!-- NICE KICKED-BY LIST -->
    <div id="nice-list" data-role="page">
      <div data-role="header">
        <a href="#" data-rel="back">Back</a>
        <h1>Some ASSHOLE kicked you, guess who!</h1>
      </div>
      <div data-role="content">
        <ul data-role="listview" data-inset="true">
          <li>
            <a href="#leaderboard" data-transition="flip" class="ui-link-inherit">
              <img class="ui-li-thumb ui-corner-all" data-bind="if: localUser, attr: { src: localUser().fbProfileUrl }" width="80" height="80"/>
              <h3 class="ui-li-heading" data-bind="if: localUser, text: localUser().first_name"></h3>
              <p class="ui-li-desc" data-bind="if: localUser, text: localUser().score"></p>
            </a>
          </li>
        </ul>
        <ul data-role="listview" data-inset="true" data-bind="foreach: allUsers">
          <!-- ko if: id != FLApp.localUser().id -->
          <li style="padding-left: 80px; min-height: 55px;">
            <a data-bind="attr: { onClick: 'FLModel.guess(FLApp.localUser(), FLApp.lastKickedBy, ' + $data.id + ')' }">
              <img class="ui-li-thumb ui-corner-all leaderboard-profile-img" data-bind="attr: { src: fbProfileUrl }"/>
              <h3 data-bind="text: name">player</h3>
              <h4 style="position: absolute; right: 20px; top: 10px;">score <span data-bind="text: score">pts</span></h4>
            </a>
          </li>
          <!-- /ko -->
        </ul>
      </div>
    </div>

    <!-- LEADERBOARD -->
    <div id="leaderboard" data-role="page">
      <div data-role="header"><a href="#" data-rel="back">Back</a><h1>Leaderboard</h1></div>
      <div data-role="content">
        <ul data-role="listview" data-inset="true" data-bind="foreach: allUsers">
          <li style="padding-left: 80px; min-height: 55px;" data-bind="attr: {'data-theme': ($data.id == FLApp.localUser().id) ? 'c' : 'b'}">
            <img class="ui-li-thumb ui-corner-all leaderboard-profile-img" data-bind="attr: { src: fbProfileUrl }"/>
            <h3>(<span data-bind="text: $index() + 1"></span>) <span data-bind="text: name"></span></h3>
            <h4 style="position: absolute; right: 20px; top: 10px;">respect: <span data-bind="text: score">pts</span></h4>
          </li>
        </ul>
      </div>
    </div>

    <script type="text/javascript">

      FLApp = {} // app namespace to apply Knockout bindings
      FLApp.localUser = ko.observable(false);
      FLApp.allUsers = ko.observableArray(); // FLApp.players(array) // to set a new list of array

      ko.applyBindings(FLApp);
    </script>

  </body>
</html>
