<!DOCTYPE html>
<html>
  <head>
    <title>Real-life Games Engine</title>

  	<meta name="apple-mobile-web-app-capable" content="yes" />
  	<meta names="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no;" />
  	<meta charset="utf-8">

  	<link rel="stylesheet" href="index.css" />

  	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.css" />
  	<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
  	<script src="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.js"></script>

    <script type="text/javascript" charset="utf-8" src="http://static.firebase.com/v0/firebase.js"></script>

    <script type="text/javascript" charset="utf-8" src="knockout.js"></script>
    <script type="text/javascript" charset="utf-8" src="underscore.js"></script>
    <script type="text/javascript" charset="utf-8" src="cordova-1.8.1.js"></script>


    <script type="text/javascript" charset="utf-8" src="user.js"></script>
    <script type="text/javascript" charset="utf-8" src="model.js"></script>

  </head>
  <body>

    <!-- Initialization STUFF -->

    <div id="fb-root"></div>

    <script>
      (function() {
        var e = document.createElement('script'); e.async = true;
            e.src = document.location.protocol + '//connect.facebook.net/en_US/all.js';
            document.getElementById('fb-root').appendChild(e);
            }());
    </script>

    <script>
      window.fbAsyncInit = function() {
        FB.init({ appId: '450301521661226',
                  status: true,
                  cookie: true,
                  xfbml: true,
                  oauth: true});

        FB.Event.subscribe('auth.statusChange', handleStatusChange);
      };

      function handleStatusChange(response) {
        document.body.className = response.authResponse ? 'connected' : 'not_connected';

        if (response.authResponse) {
          onUserLoggedIn(response);
        }
      }

      function onUserLoggedIn(response) {
        //$('#login').remove();
        // Stop commenting this out!!!
        $.mobile.changePage('#ass-main'); // go to a page programatically
        FB.api('/me', onUserFetch);
      }

      function onUserFetch(fbUserProfile) {
        FLModel.createUser(fbUserProfile.id, fbUserProfile, function(userId) {
          FLModel.bindUserChange(userId, function(user) { FLApp.localUser(user); });
          FLModel.bindUsersChange(function(users) { FLApp.allUsers(users); });
        });
        // Add the avatar image in the divs with class .user-avatar
        //var avatarImgHtml = '<img class="ui-corner-all" src="https://graph.facebook.com/' + fbUserProfile.id + '/picture"/>';
        //$('.user-avatar').html(avatarImgHtml);
      }

      function loginUser() {
        FB.login(function(response) { }, {scope:'email'});
      }
    </script>


    <!-- START PAGE -->
    <div id="page" data-role="page">
      <div data-role="header"><h1>Asshole</h1></div>
      <div data-role="content">
        <p>A game where you have to kick ass</p>
        <div id="login">
          <button data-role="button" onClick="loginUser();">Login</button>
        </div>
        <a href="#ass-main" data-role="button" data-transition="slide">Be an Asshole</a>
        <a href="#nice-main" data-role="button" data-transition="slide">Be a nice man</a>
      </div>
    </div>


    <!-- ASSHOLE MAIN -->
    <div id="ass-main" data-role="page">
      <div data-role="header">
        <a href="#" data-rel="back">Back</a>
        <h1>You're the Asshole</h1>
      </div>
      <div data-role="content">
        <ul data-role="listview" data-inset="true" data-split-theme="a">
          <li>
            <a href="#leaderboard" data-transition="flip" class="ui-link-inherit">
              <img class="ui-li-thumb ui-corner-all" data-bind="if: localUser, attr: { src: localUser().fbProfileUrl }" width="80" height="80"/>
              <h3 class="ui-li-heading" data-bind="if: localUser, text: localUser().first_name"></h3>
              <p class="ui-li-desc">2nd  40pts</p>
            </a>
          </li>
        </ul>
        <p>Time to kick some ass</p>
        <a href="#ass-list" data-role="button" data-transition="slide">Kick someone!</a>
      </div>
    </div>

    <!-- NICE MAIN -->
    <div id="nice-main" data-role="page">
      <div data-role="header">
        <a href="#" data-rel="back">Back</a>
        <h1>You're the Nice Guy</h1>
      </div>
      <div data-role="content">
        <ul data-role="listview" data-inset="true" data-split-theme="a">
          <li>
            <a href="#leaderboard" class="ui-link-inherit">
              <img class="ui-li-thumb ui-corner-all" data-bind="if: localUser, attr: { src: localUser().fbProfileUrl }" width="80" height="80"/>
              <h3 class="ui-li-heading" data-bind="if: localUser, text: localUser().first_name"></h3>
              <p class="ui-li-desc">2nd  40pts</p>
            </a>
          </li>
        </ul>
      </div>
    </div>

    <!-- LEADERBOARD -->
    <div id="leaderboard" data-role="page">
      <div data-role="header"><a href="#" data-rel="back">Back</a><h1>Leaderboard</h1></div>
      <div data-role="content">
        <ul data-role="listview" data-inset="true" data-bind="foreach: allUsers">
          <li style="padding-left: 80px; min-height: 55px;">
            <img class="ui-li-thumb ui-corner-all leaderboard-profile-img" data-bind="attr: { src: fbProfileUrl }"/>
            <h3 data-bind="text: name">player</h3>
            <h4 style="position: absolute; right: 20px; top: 10px;">score <span data-bind="text: score">pts</span></h4>
          </li>
        </ul>
      </div>
    </div>

    <script type="text/javascript">

      FLApp = {} // app namespace to apply Knockout bindings
      FLApp.localUser = ko.observable(false);
      FLApp.allUsers = ko.observableArray(); // FLApp.players(array) // to set a new list of array

      ko.applyBindings(FLApp);
    </script>

  </body>
</html>
